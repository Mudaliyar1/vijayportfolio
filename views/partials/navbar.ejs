<style>
  /* Dropdown animations */
  .dropdown-menu {
    transition: all 0.2s ease-in-out;
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    display: none;
  }

  .dropdown-menu.active {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    display: block;
  }

  /* Mobile dropdown animations */
  .mobile-dropdown > div {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out;
  }

  .mobile-dropdown > div:not(.hidden) {
    max-height: 200px;
  }

  /* Dropdown button hover effect */
  .dropdown-btn {
    position: relative;
  }

  .dropdown-btn::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 100%;
    height: 2px;
    background: linear-gradient(to right, transparent, rgba(59, 130, 246, 0.5), transparent);
    transform: scaleX(0);
    transition: transform 0.3s ease;
  }

  .dropdown-btn:hover::after {
    transform: scaleX(1);
  }
</style>

<nav class="bg-dark-200 border-b border-gray-800">
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-center py-4">
      <!-- Logo -->
      <a href="/" class="flex items-center space-x-2">
        <span class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-neon-blue to-neon-purple">FTRAISE AI</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-6">
        <a href="/" class="text-gray-300 hover:text-white transition-colors">Home</a>

        <!-- AI Tools Dropdown -->
        <div class="relative">
          <button class="flex items-center space-x-1 text-gray-300 hover:text-white transition-colors focus:outline-none dropdown-btn" data-dropdown-id="ai-tools-dropdown">
            <span>AI Tools</span>
            <i class="fas fa-chevron-down text-xs"></i>
          </button>
          <div id="ai-tools-dropdown" class="absolute left-0 mt-2 w-48 bg-dark-100 border border-gray-800 rounded-md shadow-lg py-1 z-10 dropdown-menu">
            <a href="/chat" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-comments mr-2"></i> AI Chat
            </a>
            <a href="/images" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-image mr-2"></i> AI Images
            </a>
            <a href="/website-builder/dashboard" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-globe mr-2"></i> Website Builder
            </a>
          </div>
        </div>

        <!-- Community Dropdown -->
        <div class="relative">
          <button class="flex items-center space-x-1 text-gray-300 hover:text-white transition-colors focus:outline-none dropdown-btn" data-dropdown-id="community-dropdown">
            <span>Community</span>
            <i class="fas fa-chevron-down text-xs"></i>
          </button>
          <div id="community-dropdown" class="absolute left-0 mt-2 w-48 bg-dark-100 border border-gray-800 rounded-md shadow-lg py-1 z-10 dropdown-menu">
            <a href="/blog" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-newspaper mr-2"></i> Blog
            </a>
            <a href="/community" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-users mr-2"></i> Community
            </a>
          </div>
        </div>

        <!-- Resources Dropdown -->
        <div class="relative">
          <button class="flex items-center space-x-1 text-gray-300 hover:text-white transition-colors focus:outline-none dropdown-btn" data-dropdown-id="resources-dropdown">
            <span>Resources</span>
            <i class="fas fa-chevron-down text-xs"></i>
          </button>
          <div id="resources-dropdown" class="absolute left-0 mt-2 w-48 bg-dark-100 border border-gray-800 rounded-md shadow-lg py-1 z-10 dropdown-menu">
            <a href="/packages" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-box mr-2"></i> Packages
            </a>
            <a href="/demo" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-laptop-code mr-2"></i> Demo
            </a>
            <a href="/analytics" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-chart-line mr-2"></i> Analytics
            </a>
            <a href="/about" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
              <i class="fas fa-info-circle mr-2"></i> About
            </a>
          </div>
        </div>



        <% if (typeof user !== 'undefined' && user) { %>
          <div class="relative">
            <button class="flex items-center space-x-2 text-gray-300 hover:text-white transition-colors focus:outline-none dropdown-btn" data-dropdown-id="profile-dropdown">
              <img src="<%= user.profilePicture %>" alt="<%= user.username %>" class="w-8 h-8 rounded-full object-cover border border-neon-blue">
              <span><%= user.username %></span>
              <i class="fas fa-chevron-down text-xs"></i>
            </button>
            <div id="profile-dropdown" class="absolute right-0 mt-2 w-48 bg-dark-100 border border-gray-800 rounded-md shadow-lg py-1 z-10 dropdown-menu">
              <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
                <a href="/admin" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
                  <i class="fas fa-tachometer-alt mr-2"></i> Admin Dashboard
                </a>
              <% } %>
              <a href="/profile" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
                <i class="fas fa-user mr-2"></i> My Profile
              </a>
              <!-- Messages link removed as requested -->

              <a href="/blog/create/new" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
                <i class="fas fa-newspaper mr-2"></i> Create Blog
              </a>
              <a href="/community/create/new" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
                <i class="fas fa-users mr-2"></i> Create Community Post
              </a>
              <a href="/rate-limits/request" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
                <i class="fas fa-tachometer-alt mr-2"></i> Request Rate Limit
              </a>
              <a href="/users/logout" class="block px-4 py-2 text-sm text-gray-300 hover:bg-dark-200 hover:text-white">
                <i class="fas fa-sign-out-alt mr-2"></i> Logout
              </a>
            </div>
          </div>
        <% } else { %>
          <a href="/users/login" class="px-4 py-2 rounded-md bg-gradient-to-r from-neon-blue to-neon-purple text-white hover:opacity-90 transition-opacity">Login</a>
          <a href="/users/register" class="px-4 py-2 rounded-md border border-neon-blue text-white hover:bg-neon-blue/10 transition-colors">Register</a>
        <% } %>
      </div>

      <!-- Mobile Menu Button -->
      <button id="mobile-menu-button" class="md:hidden text-gray-300 hover:text-white focus:outline-none">
        <i class="fas fa-bars text-xl"></i>
      </button>
    </div>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="md:hidden hidden pb-4">
      <div class="flex flex-col space-y-3">
        <a href="/" class="text-gray-300 hover:text-white transition-colors py-2">Home</a>

        <!-- AI Tools Mobile Dropdown -->
        <div class="mobile-dropdown">
          <button class="flex items-center justify-between w-full text-gray-300 hover:text-white transition-colors py-2 focus:outline-none mobile-dropdown-btn" data-dropdown-id="ai-tools-dropdown-mobile">
            <span>AI Tools</span>
            <i class="fas fa-chevron-down text-xs"></i>
          </button>
          <div id="ai-tools-dropdown-mobile" class="hidden pl-4 mt-1 border-l border-gray-700">
            <a href="/chat" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-comments mr-2"></i> AI Chat
            </a>
            <a href="/images" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-image mr-2"></i> AI Images
            </a>
            <a href="/website-builder/dashboard" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-globe mr-2"></i> Website Builder
            </a>
          </div>
        </div>

        <!-- Community Mobile Dropdown -->
        <div class="mobile-dropdown">
          <button class="flex items-center justify-between w-full text-gray-300 hover:text-white transition-colors py-2 focus:outline-none mobile-dropdown-btn" data-dropdown-id="community-dropdown-mobile">
            <span>Community</span>
            <i class="fas fa-chevron-down text-xs"></i>
          </button>
          <div id="community-dropdown-mobile" class="hidden pl-4 mt-1 border-l border-gray-700">
            <a href="/blog" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-newspaper mr-2"></i> Blog
            </a>
            <a href="/community" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-users mr-2"></i> Community
            </a>
          </div>
        </div>

        <!-- Resources Mobile Dropdown -->
        <div class="mobile-dropdown">
          <button class="flex items-center justify-between w-full text-gray-300 hover:text-white transition-colors py-2 focus:outline-none mobile-dropdown-btn" data-dropdown-id="resources-dropdown-mobile">
            <span>Resources</span>
            <i class="fas fa-chevron-down text-xs"></i>
          </button>
          <div id="resources-dropdown-mobile" class="hidden pl-4 mt-1 border-l border-gray-700">
            <a href="/packages" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-box mr-2"></i> Packages
            </a>
            <a href="/demo" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-laptop-code mr-2"></i> Demo
            </a>
            <a href="/analytics" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-chart-line mr-2"></i> Analytics
            </a>
            <a href="/about" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-info-circle mr-2"></i> About
            </a>
          </div>
        </div>



        <% if (user) { %>
          <div class="border-t border-gray-800 my-2 pt-2">
            <div class="flex items-center space-x-2 mb-3">
              <img src="<%= user.profilePicture %>" alt="<%= user.username %>" class="w-8 h-8 rounded-full object-cover border border-neon-blue">
              <span class="text-white"><%= user.username %></span>
            </div>
            <% if (user.role === 'admin') { %>
              <a href="/admin" class="block py-2 text-gray-300 hover:text-white">
                <i class="fas fa-tachometer-alt mr-2"></i> Admin Dashboard
              </a>
            <% } %>
            <a href="/profile" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-user mr-2"></i> My Profile
            </a>
            <!-- Messages link removed as requested -->

            <a href="/blog/create/new" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-newspaper mr-2"></i> Create Blog
            </a>
            <a href="/community/create/new" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-users mr-2"></i> Create Community Post
            </a>
            <a href="/rate-limits/request" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-tachometer-alt mr-2"></i> Request Rate Limit
            </a>
            <a href="/users/logout" class="block py-2 text-gray-300 hover:text-white">
              <i class="fas fa-sign-out-alt mr-2"></i> Logout
            </a>
          </div>
        <% } else { %>
          <div class="flex flex-col space-y-3 pt-2">
            <a href="/users/login" class="px-4 py-2 rounded-md bg-gradient-to-r from-neon-blue to-neon-purple text-white hover:opacity-90 transition-opacity text-center">Login</a>
            <a href="/users/register" class="px-4 py-2 rounded-md border border-neon-blue text-white hover:bg-neon-blue/10 transition-colors text-center">Register</a>
          </div>
        <% } %>
      </div>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.onclick = function() {
        mobileMenu.classList.toggle('hidden');
      };
    }
  });

  // Desktop dropdown toggle function
  function toggleDesktopDropdown(id) {
    console.log('Toggling desktop dropdown:', id);
    const dropdown = document.getElementById(id);

    if (!dropdown) {
      console.error('Dropdown element not found:', id);
      return;
    }

    const allDropdowns = document.querySelectorAll('.dropdown-menu');

    // Close all other dropdowns
    allDropdowns.forEach(item => {
      if (item.id !== id && item.classList.contains('active')) {
        item.classList.remove('active');
        // Reset all other dropdown icons
        const parentButton = item.previousElementSibling;
        if (parentButton && parentButton.querySelector('i.fas')) {
          parentButton.querySelector('i.fas').classList.remove('fa-chevron-up');
          parentButton.querySelector('i.fas').classList.add('fa-chevron-down');
        }
      }
    });

    // Toggle current dropdown
    dropdown.classList.toggle('active');
    console.log('Dropdown active?', dropdown.classList.contains('active'));

    // Toggle icon
    const button = dropdown.previousElementSibling;
    const icon = button.querySelector('i.fas');
    if (!dropdown.classList.contains('active')) {
      icon.classList.remove('fa-chevron-up');
      icon.classList.add('fa-chevron-down');
    } else {
      icon.classList.remove('fa-chevron-down');
      icon.classList.add('fa-chevron-up');
    }

    // Close dropdown when clicking outside
    if (dropdown.classList.contains('active')) {
      document.addEventListener('click', closeDropdownOnClickOutside);
    }
  }

  // Close dropdown when clicking outside
  function closeDropdownOnClickOutside(event) {
    const dropdowns = document.querySelectorAll('.dropdown-menu.active');
    dropdowns.forEach(dropdown => {
      const button = dropdown.previousElementSibling;
      if (!dropdown.contains(event.target) && !button.contains(event.target)) {
        dropdown.classList.remove('active');
        const icon = button.querySelector('i.fas');
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
      }
    });

    if (document.querySelectorAll('.dropdown-menu.active').length === 0) {
      document.removeEventListener('click', closeDropdownOnClickOutside);
    }
  }

  // Mobile dropdown toggle function
  function toggleMobileDropdown(id) {
    console.log('Toggling mobile dropdown:', id);
    console.log('Element exists:', !!document.getElementById(id));
    const dropdown = document.getElementById(id);

    if (!dropdown) {
      console.error('Dropdown element not found:', id);
      return;
    }

    // Close all dropdowns
    const allDropdowns = document.querySelectorAll('.mobile-dropdown > div');
    allDropdowns.forEach(item => {
      if (item.id !== id) {
        item.classList.add('hidden');
        // Reset all other dropdown icons
        const parentButton = item.previousElementSibling;
        if (parentButton && parentButton.querySelector('i.fas')) {
          parentButton.querySelector('i.fas').classList.remove('fa-chevron-up');
          parentButton.querySelector('i.fas').classList.add('fa-chevron-down');
        }
      }
    });

    // Toggle current dropdown
    dropdown.classList.toggle('hidden');

    // Toggle icon
    const button = dropdown.previousElementSibling;
    const icon = button.querySelector('i.fas');
    console.log('Button:', button);
    console.log('Icon:', icon);
    console.log('Icon classes before:', icon ? icon.className : 'No icon found');

    if (dropdown.classList.contains('hidden')) {
      if (icon) {
        icon.classList.remove('fa-chevron-up');
        icon.classList.add('fa-chevron-down');
      }
    } else {
      if (icon) {
        icon.classList.remove('fa-chevron-down');
        icon.classList.add('fa-chevron-up');
      }
    }

    console.log('Icon classes after:', icon ? icon.className : 'No icon found');
    console.log('Dropdown state:', dropdown.classList.contains('hidden') ? 'hidden' : 'visible');
  }

  // Initialize dropdown states
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing dropdowns');

    // Check if mobile dropdowns exist
    const mobileDropdowns = document.querySelectorAll('.mobile-dropdown > div');
    console.log('Mobile dropdowns found:', mobileDropdowns.length);

    // Hide all mobile dropdowns initially
    mobileDropdowns.forEach(dropdown => {
      console.log('Initializing dropdown:', dropdown.id);
      dropdown.classList.add('hidden');
    });

    // Hide all desktop dropdowns initially
    document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
      dropdown.classList.remove('active');
    });

    // Add click event listeners to all mobile dropdown buttons
    const mobileButtons = document.querySelectorAll('.mobile-dropdown-btn');
    console.log('Mobile dropdown buttons found:', mobileButtons.length);

    mobileButtons.forEach(button => {
      console.log('Adding click listener to button:', button);
      console.log('Button dropdown ID:', button.getAttribute('data-dropdown-id'));

      button.onclick = function(e) {
        console.log('Mobile dropdown button clicked');
        e.preventDefault();
        e.stopPropagation();
        const dropdownId = this.getAttribute('data-dropdown-id');
        console.log('Dropdown ID from click:', dropdownId);
        toggleMobileDropdown(dropdownId);
      };
    });

    // Close mobile dropdowns when clicking outside
    document.addEventListener('click', function(e) {
      document.querySelectorAll('.mobile-dropdown > div:not(.hidden)').forEach(dropdown => {
        const button = dropdown.previousElementSibling;
        if (!dropdown.contains(e.target) && !button.contains(e.target)) {
          dropdown.classList.add('hidden');

          // Reset the icon
          const icon = button.querySelector('i.fas');
          if (icon) {
            icon.classList.remove('fa-chevron-up');
            icon.classList.add('fa-chevron-down');
          }
        }
      });
    });

    // Log all mobile dropdown buttons for debugging
    console.log('Mobile dropdown buttons:');
    document.querySelectorAll('.mobile-dropdown-btn').forEach((btn, i) => {
      console.log(i, btn.getAttribute('data-dropdown-id'));
    });

    // Add click event listeners to all desktop dropdown buttons
    document.querySelectorAll('.dropdown-btn').forEach(button => {
      button.onclick = function(e) {
        e.preventDefault();
        e.stopPropagation();
        const dropdownId = this.getAttribute('data-dropdown-id');
        toggleDesktopDropdown(dropdownId);
      };
    });
  });
</script>
